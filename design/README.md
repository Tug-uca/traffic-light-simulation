# 交差点信号機シミュレーション - 設計ドキュメント

## プロジェクト概要

本プロジェクトは、交差点における信号機の切り替えルール設計のためのエージェントベースシミュレーションです。ODDプロトコル（Overview, Design concepts, Details）に従って設計されています。

---

## ドキュメント構成

本ディレクトリには以下のドキュメントが含まれています：

### 1. `odd_protocol_plan.md` - 作業計画
プロジェクト全体の作業計画とタスクリスト。6つのフェーズに分けられた詳細な計画が記載されています。

### 2. `odd_document.md` - ODDプロトコルドキュメント（約2300行）
シミュレーションの完全な技術仕様。以下の3部構成：

#### 第1部: OVERVIEW（概要）
- **1.1 Purpose**: シミュレーションの目的と対象とする研究課題
- **1.2 Entities, State Variables, and Scales**:
  - Vehicle（車両エージェント）の詳細な状態変数
  - TrafficLight（信号機）の定義
  - Intersection（交差点環境）の定義
  - 空間的・時間的スケールの定義
- **1.3 Process Overview and Scheduling**:
  - 6フェーズからなるメインループ
  - 車両生成、信号機更新、行動決定、位置更新の詳細アルゴリズム

#### 第2部: DESIGN CONCEPTS（設計概念）
- **2.1 Basic Principles**: 交通工学の理論的基盤（IDM、交通流理論、待ち行列理論）
- **2.2 Emergence**: 渋滞形成などの創発的現象
- **2.3 Adaptation**: 車両の適応的行動
- **2.4 Objectives**: エージェントとシステムの目的関数
- **2.5 Learning**: 学習機能（将来の拡張）
- **2.6 Prediction**: 車両とシステムの予測能力
- **2.7 Sensing**: エージェントの感知能力
- **2.8 Interaction**: エージェント間の相互作用
- **2.9 Stochasticity**: 確率的要素と決定論的要素
- **2.10 Observation**: データ収集と観測方法

#### 第3部: DETAILS（詳細）
- **3.1 Initialization**: シミュレーション初期化の完全な手順
- **3.2 Input Data**: 入力パラメータの一覧とフォーマット
- **3.3 Submodels**:
  - 車両移動サブモデル（IDM実装）
  - 信号制御サブモデル（固定サイクル）
  - 車両生成サブモデル（ポアソン過程）
  - 交差点通過判定
  - データ収集

### 3. `implementation_plan.md` - 実装計画
GitHub Pages公開可能なWebアプリケーションとしての実装計画：

- **技術スタック**: TypeScript + HTML5 Canvas
- **システムアーキテクチャ**: モジュール構成とクラス設計
- **開発フェーズ**: 10フェーズ、合計17日間の開発計画
- **クラス詳細設計**: 主要クラスの完全なコード例
- **テスト計画**: 単体テスト・統合テストの方針
- **デプロイ設定**: GitHub Actions CI/CD設定

---

## 設計の要点

### シミュレーションの目的
**車両の待ち時間削減**を主目的とし、以下の評価指標を使用：
- 平均待ち時間
- 最大待ち時間
- 交差点通過台数（スループット）
- 渋滞長（キューの長さ）

### 主要な設計決定

#### 1. 交差点構造
- **柔軟な設計**: シミュレーション内で十字路、T字路など選択可能
- **パラメータ化**: 車線数、交差点サイズなど調整可能

#### 2. 車両モデル
- **エージェントベース**: 各車両は独立した自律エージェント
- **IDM（Intelligent Driver Model）簡易版**: 現実的な車両追従行動
- **状態変数**: 位置、速度、待ち時間など12個の変数で管理

#### 3. 信号制御
- **固定サイクル方式**: 予測可能で実装が容易
- **将来の拡張性**: 感応式、適応型制御への拡張が可能

#### 4. 確率的要素
- **ポアソン到着**: 車両の到着は標準的な交通モデルに準拠
- **再現性**: シード固定により同一条件での再実行が可能

### 技術的特徴

#### 理論的基盤
- **車両追従モデル**: Intelligent Driver Model (IDM)
- **交通流理論**: Q = k * v の基本関係式
- **待ち行列理論**: M/D/1 モデル
- **Webster法**: 最適サイクル長の理論式

#### 創発的現象
- **渋滞の形成と消散**: Shockwave（衝撃波）の伝播
- **交通流の相転移**: 自由流 → 同期流 → 渋滞流
- **最適化の創発的発見**: パラメータ実験による最適値の発見

#### データ駆動設計
- **包括的データ収集**: 個別車両、時系列、集計統計
- **多様な出力形式**: JSON、CSV、リアルタイム可視化
- **統計分析**: 平均、中央値、標準偏差、パーセンタイル

---

## 実装の方針

### MVP（Minimum Viable Product）
1. 十字路での固定サイクル信号制御
2. 基本的な車両生成と移動
3. 待ち時間とスループットの測定
4. Canvas による可視化
5. 基本的なパラメータ調整UI

### 拡張機能（Phase 2）
- T字路のサポート
- 複数シナリオの保存/読込
- パラメータスイープ（自動実験）
- 高度な統計分析とグラフ
- 感応式信号制御

### 長期的ビジョン
- 歩行者の追加
- 右左折専用車線
- 強化学習による信号最適化
- マルチ交差点ネットワーク
- リアルタイム交通データの取り込み

---

## 開発スケジュール

| フェーズ | 内容 | 期間 |
|---------|------|------|
| 1 | プロジェクトセットアップ | 1日 |
| 2 | コアエンティティ実装 | 2日 |
| 3 | シミュレーションロジック | 3日 |
| 4 | データ収集と統計 | 1日 |
| 5 | 可視化実装 | 3日 |
| 6 | UIとインタラクション | 2日 |
| 7 | テストとバリデーション | 2日 |
| 8 | 最適化 | 1日 |
| 9 | ドキュメント | 1日 |
| 10 | デプロイ | 1日 |

**総開発期間**: 約17日間（実働）

---

## 使用する技術

### フロントエンド
- **言語**: TypeScript 5.3+
- **ビルドツール**: Vite
- **描画**: HTML5 Canvas API
- **UI**: Vanilla TypeScript + HTML/CSS
- **グラフ**: Chart.js（オプション）

### ライブラリ
- **乱数**: seedrandom.js（再現性のため）
- **テスト**: Vitest

### デプロイ
- **ホスティング**: GitHub Pages
- **CI/CD**: GitHub Actions
- **バージョン管理**: Git

---

## 参考文献

### 学術文献
1. Grimm, V., et al. (2006). "A standard protocol for describing individual-based and agent-based models." Ecological Modelling, 198(1-2), 115-126.
2. Grimm, V., et al. (2010). "The ODD protocol: A review and first update." Ecological Modelling, 221(23), 2760-2768.
3. Treiber, M., Hennecke, A., & Helbing, D. (2000). "Congested traffic states in empirical observations and microscopic simulations." Physical Review E, 62(2), 1805.

### 交通工学
- Webster, F. V. (1958). "Traffic Signal Settings." Road Research Technical Paper No. 39.
- Highway Capacity Manual (HCM) 2010.

---

## ドキュメントの更新履歴

| 日付 | バージョン | 内容 |
|------|----------|------|
| 2025-12-03 | 1.0 | 初版作成（ODDプロトコル、実装計画） |

---

## ライセンス

このプロジェクトのライセンスは、実装時に決定されます。
推奨: MIT License（オープンソースとして公開する場合）

---

## 連絡先

プロジェクトに関する質問や提案は、GitHubのIssueを通じてお願いします。

---

**ドキュメント作成日**: 2025-12-03
**ステータス**: 設計完了、実装準備完了
