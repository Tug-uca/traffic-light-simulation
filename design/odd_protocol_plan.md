# 交差点信号機シミュレーション - ODDプロトコル設計計画

## プロジェクト概要
本プロジェクトは、交差点の信号機切り替えルール設計のためのエージェントベースシミュレーションをODD（Overview, Design concepts, Details）プロトコルに従って開発します。

---

## 作業ステップ

### フェーズ1: プロジェクト準備と要件定義

#### ステップ1.1: プロジェクト構造の作成
- [x] ドキュメントディレクトリ構造の作成
- [x] 基本ドキュメントテンプレートの準備

#### ステップ1.2: 要件定義（ユーザーヒアリング）✅ 完了

**[Question 1] シミュレーションの目的**
このシミュレーションの主な目的は何ですか？以下から選択するか、複数選択してください：
- 交通流の最適化
- 車両の待ち時間削減
- 交通安全性の向上
- CO2排出量の削減
- その他（具体的に記述してください）

[Answer 1]
待ち時間の削減


**[Question 2] 交差点の構造**
シミュレーション対象の交差点について教えてください：
- 交差点のタイプ（十字路、T字路、五差路など）
- 各方向の車線数（直進、右折、左折）
- 歩行者横断歩道の有無
- その他の特徴

[Answer 2]
交差点の構造はシミュレーション内で選択できる（十字路、T字路など複数のパターンをサポート）


**[Question 3] 考慮するエンティティ**
シミュレーションで考慮すべきエンティティを選択してください：
- 車両（乗用車）
- 大型車両（バス、トラック）
- 二輪車（バイク、自転車）
- 歩行者
- 緊急車両
- その他

[Answer 3]
基本的には車両（乗用車）を考慮。その他のエンティティは設計者の判断で適宜追加可能とする。


**[Question 4] 時間スケールとシミュレーション期間**
- シミュレーションの時間単位（秒単位のステップ？）
- 1回のシミュレーション実行時間（例：1時間、1日）
- 考慮すべき時間帯（朝の通勤時間、昼間、夕方など）

[Answer 4]
設計者の判断に任せる。標準的な設定として以下を推奨：
- 時間単位: 0.1秒または1秒のタイムステップ
- シミュレーション期間: 10分～30分程度
- 時間帯: 一般的な交通量を想定


**[Question 5] 信号機の制御方式**
検討したい信号機の制御方式を教えてください：
- 固定サイクル方式
- 感応式（車両検知に基づく）
- 適応型（交通状況に応じて動的に変更）
- その他の方式

[Answer 5]
固定サイクル方式


**[Question 6] 評価指標**
シミュレーション結果の評価に使用する指標を選択してください：
- 平均待ち時間
- 最大待ち時間
- 交差点通過台数（スループット）
- 渋滞長（キューの長さ）
- 燃料消費量またはCO2排出量
- 安全性指標（ニアミス回数など）
- その他

[Answer 6]
主要指標: 平均待ち時間、最大待ち時間
補助指標: 交差点通過台数（スループット）、渋滞長（キューの長さ）


---

### フェーズ2: ODDプロトコル - Overview（概要）の作成 ✅ 完了

#### ステップ2.1: Purpose（目的）の記述 ✅
- [x] シミュレーションの目的を明確に文書化
- [x] 対象とする問いと期待される成果の記述

#### ステップ2.2: Entities, State Variables, and Scales（エンティティ、状態変数、スケール）✅
- [x] エージェントの定義（車両、歩行者など）
- [x] 各エージェントの状態変数の定義
- [x] 空間的スケールの定義（交差点のサイズ、座標系）
- [x] 時間的スケールの定義（タイムステップ、シミュレーション期間）

#### ステップ2.3: Process Overview and Scheduling（プロセス概要とスケジューリング）✅
- [x] シミュレーションのメインループの定義
- [x] 各タイムステップで実行されるアクションの順序
- [x] エージェントの行動順序の決定方法

---

### フェーズ3: ODDプロトコル - Design Concepts（設計概念）の作成 ✅ 完了

#### ステップ3.1: Basic Principles（基本原則）✅
- [x] シミュレーションの理論的基盤の記述
- [x] 交通工学の原則の適用

#### ステップ3.2: Emergence（創発）✅
- [x] システムレベルで創発する現象の特定
- [x] 渋滞パターンなどの創発的振る舞いの記述

#### ステップ3.3: Adaptation（適応）✅
- [x] エージェントの適応的行動の定義
- [x] 信号制御の適応メカニズム

#### ステップ3.4: Objectives（目的）✅
- [x] エージェントの目標の定義
- [x] 信号制御システムの最適化目標

#### ステップ3.5: Learning（学習）✅
- [x] エージェントの学習メカニズム（該当する場合）
- [x] 信号制御の学習アルゴリズム（該当する場合）

#### ステップ3.6: Prediction（予測）✅
- [x] エージェントの予測能力の定義
- [x] 信号制御における予測メカニズム

#### ステップ3.7: Sensing（感知）✅
- [x] エージェントが感知できる情報の範囲
- [x] センサーによる交通状況の検知方法

#### ステップ3.8: Interaction（相互作用）✅
- [x] エージェント間の相互作用ルール
- [x] 車両と信号機の相互作用
- [x] 衝突回避メカニズム

#### ステップ3.9: Stochasticity（確率性）✅
- [x] 確率的要素の特定（車両の到着、運転行動など）
- [x] 乱数の使用方法

#### ステップ3.10: Observation（観察）✅
- [x] データ収集方法の定義
- [x] 出力される観測データの種類

---

### フェーズ4: ODDプロトコル - Details（詳細）の作成 ✅ 完了

#### ステップ4.1: Initialization（初期化）✅
- [x] シミュレーション開始時の状態の定義
- [x] 初期パラメータ値の設定
- [x] エージェントの初期配置方法

#### ステップ4.2: Input Data（入力データ）✅
- [x] 外部データソースの特定
- [x] 入力パラメータのリスト作成
- [x] データフォーマットの定義

#### ステップ4.3: Submodels（サブモデル）✅
- [x] 車両移動モデルの詳細設計
- [x] 信号制御アルゴリズムの詳細設計
- [x] 車両生成モデルの設計
- [x] 意思決定モデルの設計
- [x] その他の必要なサブモデルの設計

---

### フェーズ5: 実装計画の策定 ✅ 完了

#### ステップ5.1: 技術スタック選定 ✅

**[Question 7] プログラミング言語と開発環境**
使用するプログラミング言語とライブラリについて教えてください：
- Python（Mesa、SimPy、PyCXなど）
- Java（RePast、MASON）
- NetLogo
- その他
- 特に指定なし（推奨を提案してください）

[Answer 7]
GitHub Pagesで公開できるもの（ブラウザベース）
推奨技術スタック:
- JavaScript/TypeScript（メインロジック）
- HTML5 Canvas または SVG（可視化）
- 軽量なフレームワーク（必要に応じて）


#### ステップ5.2: モジュール設計 ✅
- [x] システムアーキテクチャの設計
- [x] クラス構造の設計
- [x] モジュール間のインターフェース定義

#### ステップ5.3: 開発フェーズの定義 ✅
- [x] フェーズ1: 基本フレームワークの実装
- [x] フェーズ2: エージェントモデルの実装
- [x] フェーズ3: 信号制御ロジックの実装
- [x] フェーズ4: データ収集と可視化の実装
- [x] フェーズ5: 検証とテスト
- [x] フェーズ6: 実験とパラメータ調整

#### ステップ5.4: テストとバリデーション計画 ✅
- [x] 単体テスト計画
- [x] 統合テスト計画
- [x] モデル検証方法の定義
- [x] 結果の妥当性検証方法

---

### フェーズ6: ドキュメント最終化 ✅ 完了

#### ステップ6.1: 完全なODDドキュメントの作成 ✅
- [x] すべてのセクションを統合したODDドキュメントの作成
- [x] レビューと修正

#### ステップ6.2: 補足ドキュメントの作成 ✅
- [x] ユーザーマニュアルの作成（design/README.md）
- [x] 実装ガイドの作成（design/implementation_plan.md）

---

## 注意事項

- 各ステップは順番に実行されます
- [Question]タグの付いたすべての質問に回答いただいてから次のフェーズに進みます
- 各ステップ完了後、レビューと承認を求めます
- 必要に応じて計画を調整します

---

## 現在のステータス

**プロジェクトステータス**: ✅ **全フェーズ完了 - 設計ドキュメント完成**
**次のアクション**: 実装開始の準備完了

---

## 完了したフェーズ

### ✅ フェーズ1: プロジェクト準備と要件定義 - 完了
- ステップ1.1: プロジェクト構造の作成 ✅
- ステップ1.2: 要件定義（ユーザーヒアリング）✅

### ✅ フェーズ2: ODDプロトコル - Overview（概要）- 完了
- ステップ2.1: Purpose（目的）の記述 ✅
- ステップ2.2: Entities, State Variables, and Scales ✅
- ステップ2.3: Process Overview and Scheduling ✅

### ✅ フェーズ3: ODDプロトコル - Design Concepts（設計概念）- 完了
- 10個の設計概念をすべて詳細に記述 ✅

### ✅ フェーズ4: ODDプロトコル - Details（詳細）- 完了
- Initialization、Input Data、Submodels を完全に定義 ✅

### ✅ フェーズ5: 実装計画の策定 - 完了
- TypeScript + HTML5 Canvasベースの実装計画 ✅
- 17日間の開発フェーズ定義 ✅
- 完全なクラス設計とアーキテクチャ ✅

### ✅ フェーズ6: ドキュメント最終化 - 完了
- ODD完全ドキュメント（2300行超） ✅
- 実装計画ドキュメント ✅
- プロジェクトREADME ✅

### 要件定義サマリー
- **目的**: 待ち時間の削減
- **交差点構造**: シミュレーション内で選択可能（十字路、T字路など）
- **エンティティ**: 主に車両（乗用車）、その他は拡張可能
- **時間スケール**: 0.1～1秒のタイムステップ、10～30分のシミュレーション期間
- **制御方式**: 固定サイクル方式
- **評価指標**: 平均/最大待ち時間、スループット、渋滞長
- **技術スタック**: JavaScript/TypeScript + HTML5 Canvas/SVG（GitHub Pages対応）

---

## 次のアクション

🎉 **すべてのフェーズが完了しました！**

### 成果物サマリー

1. **odd_document.md** (2300+行)
   - 完全なODDプロトコルドキュメント
   - 3部構成: Overview / Design Concepts / Details
   - JavaScript実装のための詳細な疑似コード

2. **implementation_plan.md** (900+行)
   - TypeScript + HTML5 Canvas実装計画
   - 10フェーズ、17日間の開発計画
   - 完全なクラス設計とアーキテクチャ
   - GitHub Pagesデプロイ設定

3. **README.md**
   - プロジェクト全体の概要
   - ドキュメント構成の説明
   - 技術的特徴と設計の要点

### 推奨される次のステップ

実装を開始する場合：
1. プロジェクトリポジトリのセットアップ（package.json、tsconfig.json）
2. 基本的なHTMLとCSSの作成
3. Vite開発サーバーの起動
4. 実装計画のフェーズ1から順次実装
